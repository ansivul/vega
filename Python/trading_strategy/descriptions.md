# Описание торгового скрипта

Этот скрипт представляет собой торговую стратегию для криптовалютного рынка, разработанную с использованием Python. Он анализирует рыночные данные с использованием различных технических индикаторов и предоставляет рекомендации для торговли на основе индекса страха и жадности (FGI), RSI, EMA, MACD, Bollinger Bands, уровней поддержки/сопротивления и ADX. Скрипт включает улучшенный расчет вероятности успеха на основе исторических данных и трендов.

## Основные возможности
- **Анализ рыночных данных**: Сбор и обработка данных OHLCV (Open, High, Low, Close, Volume) с биржи Bybit.
- **Технические индикаторы**:
  - FGI (Fear and Greed Index) для оценки рыночных настроений.
  - RSI (Relative Strength Index) для определения перепроданности/перекупленности.
  - EMA (Exponential Moving Average) для определения тренда.
  - MACD (Moving Average Convergence Divergence) для анализа импульса.
  - Bollinger Bands для оценки волатильности и экстремальных условий.
  - Уровни поддержки и сопротивления на основе исторических минимумов и максимумов.
  - ADX (Average Directional Index) для оценки силы тренда.
- **Рассчет вероятности успеха**: Улучшенный алгоритм, основанный на исторических данных, трендах и подтверждениях индикаторов.
- **Рекомендации**: Генерация торговых сигналов (long, short, нейтральная зона) с вероятностью успеха и советами от ИИ.
- **Гибкая настройка**: Поддержка пользовательских параметров через файл `settings.json`.

## Параметры настройки (settings.json)
Ниже приведены параметры, доступные для настройки в файле `settings.json`, с их описанием:

- `"symbol": "BTCUSDT"`  
  Символ торговой пары (например, BTCUSDT для Bitcoin к USDT).
- `"timeframe": "4h"`  
  Таймфрейм для анализа (например, 4h - 4 часа).
- `"fgi_threshold_low": 25`  
  Нижний порог FGI (Fear and Greed Index) для определения страха (0-25).
- `"fgi_threshold_high": 75`  
  Верхний порог FGI для определения жадности (75-100).
- `"rsi_threshold_low": 30`  
  Нижний порог RSI для определения перепроданности (0-30).
- `"rsi_threshold_high": 70`  
  Верхний порог RSI для определения перекупленности (70-100).
- `"rsi_period": 14`  
  Период для расчета RSI (Relative Strength Index), стандартное значение 14.
- `"ema_short_period": 12`  
  Период короткой EMA (Exponential Moving Average), используется для определения тренда.
- `"ema_long_period": 26`  
  Период длинной EMA, используется для сравнения с короткой EMA.
- `"macd_fast": 12`  
  Период быстрой линии MACD (Moving Average Convergence Divergence).
- `"macd_slow": 26`  
  Период медленной линии MACD.
- `"macd_signal": 9`  
  Период сигнальной линии MACD.
- `"bollinger_period": 20`  
  Период для расчета Bollinger Bands (обычно 20).
- `"bollinger_deviation": 2`  
  Стандартное отклонение для Bollinger Bands (обычно 2).
- `"support_resistance_window": 10`  
  Окно для определения уровней поддержки и сопротивления (количество свечей).
- `"show_explanations": False`  
  Флаг, показывающий, нужно ли выводить пояснения (True/False).
- `"historical_data_limit": 100`  
  Количество свечей для анализа исторических данных.
- `"success_threshold": 0.02`  
  Порог успеха в процентах (например, 2% роста/падения для определения успешности сигнала).
- `"success_horizon": 5`  
  Горизонт для оценки успеха сигнала (количество свечей вперед).
- `"adx_period": 14`  
  Период для расчета ADX (Average Directional Index) для оценки силы тренда.

## Описание терминов и логики работы стратегии
### 1. Основные термины
- **Бычий тренд (Bullish Trend):**
  * Описание: Указывает на восходящий тренд, когда цены растут. В контексте EMA это означает, что короткая EMA (EMA Short) выше длинной EMA (EMA Long), что сигнализирует о возможном росте цены.
  * Пример: Если EMA Short = 87950, а EMA Long = 87250, это бычий тренд, так как 87950 > 87250.

- **Медвежий тренд (Bearish Trend):**
  * Описание: Указывает на нисходящий тренд, когда цены падают. В контексте EMA это означает, что короткая EMA ниже длинной EMA, что сигнализирует о возможном снижении цены.
  * Пример: Если EMA Short = 87250, а EMA Long = 87950, это медвежий тренд, так как 87250 < 87950.

- **Бычий сигнал (Bullish Signal) в MACD:**
  * Описание: Указывает на восходящий импульс, когда MACD Line выше Signal Line. Это означает, что рынок может продолжить расти.
  * Пример: Если MACD Line = 800, а Signal Line = 700, это бычий сигнал, так как 800 > 700.

- **Медвежий сигнал (Bearish Signal) в MACD:**
  * Описание: Указывает на нисходящий импульс, когда MACD Line ниже Signal Line. Это означает, что рынок может продолжить падать.
  * Пример: Если MACD Line = 700, а Signal Line = 700, это медвежий сигнал, так как 700 <= 700.

### 2. Сценарии стратегии
- **Сценарий 1: Согласованный сигнал (Long):**
  * Описание: FGI и RSI указывают на покупку (long). Это происходит, когда FGI низкий (страх, <= 25) и RSI низкий (перепроданность, <= 30). В этом случае дополнительные индикаторы (EMA, MACD) не проверяются.
  * Пример: FGI = 20, RSI = 25 → Рекомендация: "Открыть long".

- **Сценарий 2: Согласованный сигнал (Short):**
  * Описание: FGI и RSI указывают на продажу (short). Это происходит, когда FGI высокий (жадность, >= 75) и RSI высокий (перекупленность, >= 70).
  * Пример: FGI = 80, RSI = 75 → Рекомендация: "Открыть short".

- **Сценарий 3: Перекос сигналов (Long):**
  * Описание: FGI и RSI противоречат друг другу: FGI высокий (жадность, >= 75), но RSI низкий (перепроданность, <= 30). Для подтверждения сигнала проверяются объем, EMA и MACD:
    - Объем: Подтверждается, если текущий объем больше предыдущего на 20%.
    - EMA: Подтверждается, если EMA Short > EMA Long (бычий тренд).
    - MACD: Подтверждается, если MACD Line > Signal Line (бычий сигнал).
  * Пример: FGI = 80, RSI = 25, Объем: не подтверждено, EMA: подтверждено, MACD: не подтверждено → Рекомендация: "Ждем подтверждения".

- **Сценарий 4: Перекос сигналов (Short):**
  * Описание: FGI и RSI противоречат друг другу: FGI низкий (страх, <= 25), но RSI высокий (перекупленность, >= 70). Для подтверждения:
    - Объем: Подтверждается, если текущий объем больше предыдущего на 20%.
    - EMA: Подтверждается, если EMA Short < EMA Long (медвежий тренд).
    - MACD: Подтверждается, если MACD Line < Signal Line (медвежий сигнал).
  * Пример: FGI = 20, RSI = 75, Объем: подтверждено, EMA: подтверждено, MACD: подтверждено → Рекомендация: "Открыть short".

- **Сценарий 5: Нейтральная зона:**
  * Описание: FGI и RSI находятся в нейтральных значениях (не экстремальные). Нет явного сигнала для входа в рынок.
  * Пример: FGI = 50, RSI = 50 → Рекомендация: "Нейтральная зона".

### 3. Интерпретация подтверждений
- **Объем: Подтверждено / Не подтверждено:**
  * Описание: Объем подтверждает сигнал, если текущий объем вырос на 20% по сравнению с предыдущим (volume > prev_volume * 1.2). Это указывает на силу движения.
  * Пример: Предыдущий объем = 1000, текущий объем = 1300 → Подтверждено.

- **EMA: Подтверждено / Не подтверждено:**
  * Описание: EMA подтверждает сигнал, если тренд соответствует направлению сигнала (EMA Short > EMA Long для long, EMA Short < EMA Long для short).
  * Пример: Для long, EMA Short = 87950, EMA Long = 87250 → Подтверждено (бычий тренд).

- **MACD: Подтверждено / Не подтверждено:**
  * Описание: MACD подтверждает сигнал, если импульс соответствует направлению сигнала (MACD Line > Signal Line для long, MACD Line < Signal Line для short).
  * Пример: Для long, MACD Line = 700, Signal Line = 700 → Не подтверждено (медвежий сигнал).

## Логика работы
1. **Сбор данных**:
   - Данные OHLCV загружаются с биржи Bybit с использованием библиотеки `ccxt`.
   - Исторические данные используются для анализа прошлых сигналов.

2. **Расчет индикаторов**:
   - FGI собирается через API Alternative.me.
   - RSI, EMA, MACD, Bollinger Bands, ADX и уровни поддержки/сопротивления рассчитываются с помощью библиотеки `talib`.

3. **Определение сценария**:
   - Сценарии включают согласованные сигналы (long/short), перекос сигналов (divergence_long/divergence_short) и нейтральную зону.
   - Перекос подтверждается дополнительными индикаторами (объем, EMA, MACD, Bollinger Bands, уровни поддержки/сопротивления).

4. **Анализ исторических данных**:
   - Проверяется успешность прошлых сигналов на основе роста/падения цены через заданный горизонт (`success_horizon`).
   - Успешность определяется как изменение цены более чем на `success_threshold`.

5. **Расчет вероятности**:
   - Вероятность успеха базируется на исторической успешности сигналов в похожих условиях (сценарий, тренд, сила тренда).
   - Добавляется бонус за подтверждения текущих индикаторов (максимум +30%).

6. **Вывод**:
   - Отображается анализ рынка (цена, индикаторы, рекомендации).
   - Предоставляются рекомендации от ИИ с вероятностью успеха.
   - Пояснения выводятся опционально (в зависимости от `show_explanations`).

## Пример вывода

=== Анализ рынка ===
Актив: BTCUSDT, Таймфрейм: 4h
Текущая цена: 82132.00 USDT, Объем: 9865.71
EMA: Short=84870.64, Long=86126.19, Медвежий тренд
MACD: Line=-1126.77, Signal=-456.72, Медвежий сигнал
Bollinger Bands: Upper=90371.11, Middle=86351.02, Lower=82330.93
Уровни поддержки/сопротивления: Поддержка=82122.00, Сопротивление=89899.60
Рекомендация: Нейтральная зона: FGI = 27, RSI = 34.48. Возможный long (цена у нижней полосы Bollinger или у поддержки)

=== Рекомендации от ИИ ===
Рынок в нейтральной зоне. Шанс успеха: 45%. Рассмотрите long, если цена у поддержки или нижней полосы Bollinger. В противном случае воздержитесь.


## Зависимости
- `ccxt` - для взаимодействия с биржей.
- `pandas` - для обработки данных.
- `talib` - для расчета технических индикаторов.
- `requests` - для получения FGI.
- `json` - для работы с настройками.

## Установка
1. Установите зависимости:  `pip install .\requirements.txt`
2. Создайте файл `settings.json` с нужными параметрами.
3. Запустите скрипт: `python trading_strategy.py`